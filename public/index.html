<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>å›¢é˜Ÿç©ºé—´</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #2c3e50, #4ca1af);
      font-family: "Microsoft YaHei", sans-serif;
    }
    .hidden { display: none; }
    .card {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
      max-width: 400px;
      margin: 40px auto;
    }
    .sync-ok { color: #22c55e; }
    .sync-loading { color: #eab308; }
    .sync-error { color: #ef4444; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center">

<!-- ç™»å½•å®¹å™¨ -->
<div id="loginRoot" class="card w-full">
  <h2 class="text-xl font-bold text-center mb-4 text-white">æ¬¢è¿ä½¿ç”¨ Â· å›¢é˜Ÿç©ºé—´</h2>
  <p class="text-sm text-gray-200 mb-3 text-center">
    å®¢æˆ·è¯·è¾“å…¥ä¸­æ–‡å§“åï¼ˆè‡³å°‘2ä¸ªå­—ï¼‰ï¼Œç®¡ç†å‘˜è¾“å…¥ guangminghui
  </p>
  <input id="inputName" type="text" class="w-full p-2 rounded mb-3" placeholder="è¯·è¾“å…¥å§“å"/>
  <div id="adminPassWrapper" class="hidden">
    <input id="inputAdminPass" type="password" class="w-full p-2 rounded mb-3" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç "/>
  </div>
  <button id="btnLogin" class="w-full bg-blue-600 text-white py-2 rounded">è¿›å…¥</button>
</div>
<!-- ä¸»ç•Œé¢ -->
<div id="appRoot" class="hidden p-3">
  <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-2">
    <div class="text-xl font-bold text-white">å›¢é˜Ÿæ–°é—»ç©ºé—´</div>
    <div class="flex items-center gap-3 text-sm">
      <div id="onlineUsers" class="text-gray-200">åœ¨çº¿ç”¨æˆ·ï¼š0</div>
      <button id="btnLogout" class="px-3 py-1 bg-gray-800 text-white rounded">é€€å‡º</button>
    </div>
  </header>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
    <!-- æ–°é—» -->
    <section id="colNews" class="bg-white/10 rounded p-3">
      <h2 class="text-lg text-white mb-3">äº‘å–„ç»˜æ–°é—»</h2>
      <div id="newsList"></div>
      <div id="adminNewsForm" class="hidden mt-4">
        <textarea id="newsText" class="w-full p-2 rounded mb-2" placeholder="è¾“å…¥æ–°é—»å†…å®¹"></textarea>
        <input type="file" id="newsFile" class="mb-2"/>
        <button id="btnPostNews" class="px-3 py-1 bg-blue-600 text-white rounded">å‘å¸ƒæ–°é—»</button>
      </div>
    </section>

    <!-- åª’ä½“ -->
    <section id="colMedia" class="bg-white/10 rounded p-3">
      <h2 class="text-lg text-white mb-3">è§†é¢‘ä¸ç…§ç‰‡</h2>
      <div id="mediaGrid" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
      <div id="adminMediaForm" class="hidden mt-4">
        <input type="file" id="mediaFile" />
        <button id="btnUploadMedia" class="px-3 py-1 bg-green-600 text-white rounded">ä¸Šä¼ åª’ä½“</button>
        <div id="uploadProgress" class="text-sm text-gray-300 mt-1"></div>
      </div>
    </section>

    <!-- æ„¿æœ›æ±  -->
    <section id="colWish" class="bg-white/10 rounded p-3">
      <h2 class="text-lg text-white mb-3">æ„¿æœ›æ± </h2>
      <div id="wishList"></div>
      <div class="mt-3 flex gap-2">
        <input id="wishInput" class="flex-1 p-2 rounded" placeholder="å†™ä¸‹ä½ çš„æ„¿æœ›..."/>
        <button id="btnWish" class="px-3 py-1 bg-purple-600 text-white rounded">å‘å¸ƒ</button>
      </div>
    </section>
  </div>

  <div id="syncStatus" class="fixed bottom-2 left-2 text-sm text-white">ğŸŸ¡ æ­£åœ¨åŒæ­¥...</div>
</div>

<!-- é¢„è§ˆå¼¹çª— -->
<div id="modal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
  <div id="modalContent"></div>
</div>
<script>
  // ç®¡ç†å‘˜é…ç½®
  const ADMIN_NAME = "guangminghui";
  const ADMIN_PASS = "guangminghui888";

  const loginRoot = document.getElementById("loginRoot");
  const appRoot = document.getElementById("appRoot");
  const inputName = document.getElementById("inputName");
  const inputAdminPass = document.getElementById("inputAdminPass");
  const adminPassWrapper = document.getElementById("adminPassWrapper");
  const btnLogin = document.getElementById("btnLogin");
  const btnLogout = document.getElementById("btnLogout");

  const adminNewsForm = document.getElementById("adminNewsForm");
  const adminMediaForm = document.getElementById("adminMediaForm");

  let state = { me: null, isAdmin: false };

  // è¾“å…¥æ¡†æ£€æµ‹ï¼šç®¡ç†å‘˜æ˜¾ç¤ºå¯†ç æ¡†
  inputName.addEventListener("input", () => {
    if (inputName.value.trim() === ADMIN_NAME) {
      adminPassWrapper.classList.remove("hidden");
    } else {
      adminPassWrapper.classList.add("hidden");
    }
  });

  // ç™»å½•æŒ‰é’®
  btnLogin.addEventListener("click", () => {
    const name = inputName.value.trim();
    if (name === ADMIN_NAME) {
      if (inputAdminPass.value !== ADMIN_PASS) {
        alert("ç®¡ç†å‘˜å¯†ç é”™è¯¯ï¼");
        return;
      }
      state.isAdmin = true;
    } else {
      if (!/^[\u4e00-\u9fa5]{2,}$/.test(name)) {
        alert("å®¢æˆ·å§“åå¿…é¡»æ˜¯ä¸¤ä¸ªä»¥ä¸Šä¸­æ–‡ï¼");
        return;
      }
      state.isAdmin = false;
    }
    state.me = name;

    // åˆ‡æ¢ç•Œé¢
    loginRoot.classList.add("hidden");
    appRoot.classList.remove("hidden");

    if (state.isAdmin) {
      adminNewsForm.classList.remove("hidden");
      adminMediaForm.classList.remove("hidden");
    } else {
      adminNewsForm.classList.add("hidden");
      adminMediaForm.classList.add("hidden");
    }

    syncData();
  });

  // é€€å‡ºç™»å½•
  btnLogout.addEventListener("click", () => {
    state = { me: null, isAdmin: false };
    appRoot.classList.add("hidden");
    loginRoot.classList.remove("hidden");
  });
</script>
<script>
  const newsList = document.getElementById("newsList");
  const mediaGrid = document.getElementById("mediaGrid");
  const wishList = document.getElementById("wishList");

  const btnPostNews = document.getElementById("btnPostNews");
  const newsText = document.getElementById("newsText");
  const newsFile = document.getElementById("newsFile");

  const btnUploadMedia = document.getElementById("btnUploadMedia");
  const mediaFile = document.getElementById("mediaFile");
  const uploadProgress = document.getElementById("uploadProgress");

  const btnWish = document.getElementById("btnWish");
  const wishInput = document.getElementById("wishInput");

  const syncStatus = document.getElementById("syncStatus");

  // æ¨¡æ‹Ÿæ•°æ®åº“
  let db = { news: [], media: [], wishes: [] };

  // ç”Ÿæˆå”¯ä¸€ID
  function genId() {
    return Date.now() + "-" + Math.random().toString(16).slice(2);
  }

  // æ¸²æŸ“æ–°é—»
  function renderNews() {
    newsList.innerHTML = "";
    db.news.forEach(n => {
      const div = document.createElement("div");
      div.className = "p-2 mb-2 bg-white/20 rounded";
      div.innerHTML = `<p>${n.text}</p>` + (n.file ? `<img src="${n.file}" class="mt-2 max-h-40 rounded"/>` : "");
      newsList.appendChild(div);
    });
  }

  // æ¸²æŸ“åª’ä½“
  function renderMedia() {
    mediaGrid.innerHTML = "";
    db.media.forEach(m => {
      let el;
      if (m.type.startsWith("image")) {
        el = document.createElement("img");
        el.src = m.url;
      } else {
        el = document.createElement("video");
        el.src = m.url;
        el.controls = true;
      }
      el.className = "rounded w-full";
      mediaGrid.appendChild(el);
    });
  }

  // æ¸²æŸ“æ„¿æœ›æ± 
  function renderWishes() {
    wishList.innerHTML = "";
    db.wishes.forEach(w => {
      const div = document.createElement("div");
      div.className = "p-2 mb-2 bg-white/20 rounded";
      div.innerText = w.text;
      wishList.appendChild(div);
    });
  }

  // å‘å¸ƒæ–°é—»
  if (btnPostNews) {
    btnPostNews.addEventListener("click", () => {
      const text = newsText.value.trim();
      if (!text) return alert("è¯·è¾“å…¥æ–°é—»å†…å®¹ï¼");
      let fileUrl = "";
      if (newsFile.files.length > 0) {
        fileUrl = URL.createObjectURL(newsFile.files[0]);
      }
      db.news.push({ id: genId(), text, file: fileUrl });
      newsText.value = "";
      newsFile.value = "";
      renderNews();
    });
  }

  // ä¸Šä¼ åª’ä½“
  if (btnUploadMedia) {
    btnUploadMedia.addEventListener("click", () => {
      if (mediaFile.files.length === 0) return alert("è¯·é€‰æ‹©æ–‡ä»¶ï¼");
      const file = mediaFile.files[0];
      const url = URL.createObjectURL(file);
      db.media.push({ id: genId(), type: file.type, url });
      mediaFile.value = "";
      renderMedia();
    });
  }

  // å‘å¸ƒæ„¿æœ›
  btnWish.addEventListener("click", () => {
    const text = wishInput.value.trim();
    if (!text) return alert("è¯·è¾“å…¥æ„¿æœ›ï¼");
    db.wishes.push({ id: genId(), text });
    wishInput.value = "";
    renderWishes();
  });
          </script>
  <script>
  // è‡ªåŠ¨åŒæ­¥
  function syncData() {
    syncStatus.innerText = "ğŸŸ¡ æ­£åœ¨åŒæ­¥...";
    setTimeout(() => {
      renderNews();
      renderMedia();
      renderWishes();
      syncStatus.innerText = "ğŸŸ¢ å·²åŒæ­¥";
    }, 500);
  }
  setInterval(syncData, 3000);

  // é¢„è§ˆå¼¹çª—
  const modal = document.getElementById("modal");
  const modalContent = document.getElementById("modalContent");

  mediaGrid.addEventListener("click", e => {
    if (e.target.tagName === "IMG" || e.target.tagName === "VIDEO") {
      modal.classList.remove("hidden");
      modalContent.innerHTML = "";
      const clone = e.target.cloneNode(true);
      clone.className = "max-h-[80vh] max-w-[90vw] rounded";
      if (clone.tagName === "VIDEO") clone.setAttribute("controls", "true");
      modalContent.appendChild(clone);
    }
  });

  modal.addEventListener("click", () => {
    modal.classList.add("hidden");
    modalContent.innerHTML = "";
  });
</script>
</body>
</html>

          
